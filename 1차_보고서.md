# 졸업프로젝트 1차 보고서

**Team 329 (14조)**
- 2276095 김희진
- 2276225 이슬
- 2176310 이혜리

---

## 목차
[1. Team Information](#1-team-information)

[2. Project-Summary (과제 요약)](#2-project-summary--------)
   
   a. 문제점

   b. 해결책

   c. 기대효과

[3. Project-Design (과제 설계)](#3-project-design--------)
   
   a. 요구사항 정의
   
   b. 전체 시스템 구성

---

# 1. Team Information

### a. 과제명: AdaModal-Fed: Overcoming Missing Modalities with Clustering and Cross-Attention in Federated Learning Approach
(AdaModal-Fed: 연합학습 환경에서 결손 모달리티를 극복하기 위한 클러스터링 및 크로스-어텐션 접근법)

### b. 팀 정보
- **팀 번호**: 14
- **팀 이름**: team329

### c. 팀 구성원
- 김희진 (2276095)
- 이슬 (2276225)
- 이혜리 (2176310)

---

# 2. Project-Summary (과제 요약)

## 2.1. 문제 정의

### a. 의료 데이터와 멀티모달성 - missing modality
현대 의료 환경에서는 환자 한 명에 대해 다양한 형태의 데이터가 수집된다. 예를 들어, 흉부 X-ray 이미지와 해당 검사에 대한 의사의 진단 보고서(텍스트)가 함께 존재할 수 있다. 그러나 실제 임상 환경에서는 모든 환자에게서 동일한 형태의 데이터를 확보하기 어렵다. 일부 환자의 경우 이미지는 존재하지만 보고서가 누락되어 있거나, 반대로 보고서만 존재하고 이미지는 없는 경우도 발생한다. 이처럼 특정 환자 데이터에서 일부 모달리티가 결손되는 현상을 missing modality 문제라고 한다. 이 문제는 의료 AI 모델의 성능 저하와 일반화 한계를 초래한다. 각 병원은 축적된 데이터의 특성에 따라 특정 질환에 대한 예측 성능은 높을 수 있으나, 상대적으로 드물게 관찰되는 질환의 경우 성능이 현저히 저하될 수 있다. 예를 들어, 한 병원이 주로 관찰해온 질환 외의 X-ray 이미지를 새로운 환자가 지참한 경우, 해당 병원의 데이터로만 학습한 모델은 진단 보고서가 결손된 상태에서 정확한 예측을 수행하기 어렵다. 따라서 missing modality 상황에서도 성능을 유지하거나 개선할 수 있는 방법을 모색하는 것은 의료 AI의 신뢰성과 확장성을 위해 중요한 연구 과제이다.

본 연구에서는 20개의 클라이언트(병원)를 가정하여 연합학습 환경을 구성하였다. 이 중 16개 클라이언트는 이미지와 텍스트 데이터를 모두 보유하고 있으며, 2개 클라이언트는 이미지 데이터만, 나머지 2개 클라이언트는 텍스트 데이터만 보유하도록 설정하여, 실제 임상과 유사한 missing modality 시나리오를 구현하였다.

### b. 병원 간 협력 학습과 FD 기술
현실적으로 병원마다 보유한 데이터의 종류와 분포는 상이하다. 일부 병원은 이미지와 텍스트를 모두 보유하지만, 다른 병원은 이미지(X-ray)만, 혹은 텍스트 보고서만 보유한 경우도 존재한다. 이러한 환경에서 주목받는 기술이 바로 연합학습(Federated Learning, FL)과 FD(Fusion for Missing Modality/Failure-robust Design) 기술이다.

- **연합학습(FL)**: 환자의 민감한 데이터를 중앙에 모으지 않고, 각 병원에서 학습된 모델의 파라미터만 공유함으로써 전체 성능을 향상시키는 방법이다. 이를 통해 개인정보를 보호하면서도 병원 간 협력이 가능하다.
- **FD 기술**: 서로 다른 모달리티(이미지, 텍스트)를 융합(Fusion)하거나, 특정 모달리티가 결손되었을 때(Missing) 발생하는 성능 저하를 보완하는 기술이다. 이를 통해 데이터가 불완전하거나 병원마다 데이터 유형이 상이하더라도 상호 보완적 학습이 가능하다.

따라서 FL과 FD를 결합한 접근은 병원 간 데이터 편차와 missing modality 문제를 동시에 해결할 수 있는 유효한 전략이 된다.

### c. Abstract
임상 영상과 텍스트 기록은 상호 보완적 특성을 지니며 의료 인공지능의 정확한 진단과 예측에 필수적이지만, 실제 환경에서는 데이터 수집 과정에서 특정 모달리티가 결손되는 경우가 흔해 모델 성능 저하로 이어지곤 한다. 본 연구에서는 연합학습 환경에서 클라이언트별 모달리티 보유 상태가 이질적으로 분포하는 상황을 고려하여, 결손 모달리티 문제를 해결하는 새로운 프레임워크를 제안한다. 본 연구는 로컬 성능 평가와 지식 증류를 통해 성능이 저조한 클라이언트를 보완하고, 이미지·텍스트 표현을 클러스터링한 뒤 Cross-Attention과 Gating Mechanism을 활용해 글로벌 임베딩을 학습한다. 이를 통해 모달리티 결손 상황에서도 클라이언트 간 보완적 정보 공유가 가능해져 전체 시스템의 성능과 일반화 능력이 향상된다. PhysioNet의 mimic-cxr-jpg data를 기반으로 한 실험 결과, 제안 방법은 단일 모달리티 기반 학습 및 로컬 트레이닝 대비 분류 정확도에서 약 7.8% 향상되었으며, 기존 단순 집계 전략 대비 약 5.3% 성능 개선을 보였다. 또한 강건성 측면에서도 일관된 우수성을 확인할 수 있었다. 이는 클러스터링과 Cross-Attention을 결합한 제안 기법이 연합학습 환경에서 발생하는 모달리티 결손 문제를 효과적으로 완화할 수 있음을 입증하며, 향후 실질적인 의료 AI 적용에 있어 유망한 연구 방향을 제시한다.

## 2.2. 기존연구와의 비교
의료 데이터 분석 분야에서는 환자의 다양한 데이터를 활용하는 멀티모달 학습 연구가 활발히 진행되어 왔다. 실제 환경에서 발생하는 missing modality 문제를 해결하기 위해 여러 접근법이 제안되었다.

- **생성 기반 접근**: GAN, VAE, Diffusion 모델 등을 활용하여 누락된 모달리티를 인공적으로 생성하는 방법이다. 그러나 생성된 데이터가 실제 의료 데이터와 괴리가 발생할 수 있어 임상적 활용에 제약이 따른다.
- **강건 학습 기반 접근**: 학습 과정에서 의도적으로 특정 모달리티를 제거(Modality Dropout)하여 실제 결손 상황에서도 성능을 유지하도록 학습하는 방식이다. 하지만 실제 임상에서 발생하는 다양한 결손 패턴을 충분히 반영하지 못하는 한계가 있다.
- **지식 증류 기반 접근**: 모든 모달리티를 활용하는 Teacher 모델에서, 일부 모달리티만 보유한 Student 모델로 지식을 전달하는 방법이다. 이는 성능 향상에 기여하지만 Teacher와 Student 간의 구조적 차이가 클 경우 지식 전달의 효율이 저하될 수 있다.

기존 연구들이 대부분 단일 데이터셋 기반의 중앙집중식 학습에 초점을 맞춘 반면, 본 연구는 연합학습(Federated Learning) 환경을 고려한다. 또한 단순한 Teacher-Student 증류에 국한되지 않고, 클러스터링 기반 클라이언트 그룹화, Representation-level 지식 증류, 그리고 Cross-Attention 기반 글로벌 표현 학습을 결합함으로써 다양한 결손 패턴에서도 효과적으로 지식을 공유할 수 있도록 설계한 점에서 차별성을 가진다.

## 2.3. 제안 내용

### a) 문제점
현대 의료 환경에서는 환자의 다양한 정보를 멀티모달 데이터(예: 흉부 X-ray 이미지와 해당 진단 보고서 텍스트) 형태로 수집할 수 있다. 그러나 실제 임상 데이터는 항상 완전하지 않다. 일부 환자는 이미지만 존재하거나, 반대로 보고서만 존재하는 등 missing modality 문제가 빈번하게 발생한다. 이러한 결손은 학습 데이터의 불균형을 초래하며, 멀티모달 AI 모델이 기대한 성능을 발휘하지 못하게 만든다. 기존 연구들은 누락된 데이터를 생성하거나, Dropout 기법을 적용하거나, Teacher-Student 기반 증류를 통해 보완하고자 했으나, 임상적 신뢰성 부족, 실제 결손 패턴 반영 미비, 중앙집중식 환경에 한정된다는 한계가 존재한다.

### b) 해결책
본 연구에서는 연합학습(Federated Learning) 환경을 기반으로 missing modality 문제를 해결하고자 한다. 구체적으로는 다음과 같은 접근을 제안한다:

1.  **클러스터링 기반 클라이언트 그룹화**
    데이터 분포와 모달리티 결손 패턴에 따라 클라이언트를 그룹화하여, 유사한 환경을 가진 집단 내에서 협력적 학습을 가능하게 함.
2.  **Representation-level Knowledge Distillation**
    모든 모달리티를 가진 클라이언트(Teacher)로부터 결손 모달리티 클라이언트(Student)로 표현 지식을 전달하여, 누락된 입력에서도 성능 저하를 최소화함.
3.  **Cross-Attention 기반 글로벌 표현 학습**
    이미지와 텍스트 표현을 Cross-Attention을 통해 통합하여, 단일 모달리티만 가진 클라이언트도 글로벌 표현 학습에 기여할 수 있도록 함.

이를 통해 본 연구는 기존의 중앙집중식 학습 기반 연구 한계를 넘어, 실제 의료 환경과 유사한 분산 데이터 환경에서도 missing modality 문제를 효과적으로 해결할 수 있는 방법을 제시한다.

## 2.4. 기대 효과 및 의의

### a) 기대 효과

1.  **모달리티 결손 상황에서도 성능 유지**
    이미지 또는 텍스트가 누락된 상태에서도 안정적으로 진단 예측을 수행할 수 있어, 실제 임상 환경에서의 활용 가능성을 높인다.
2.  **연합학습 환경에서의 실질적 적용성 확보**
    데이터가 병원이나 기관별로 분산되어 있는 상황에서도 프라이버시를 보장하며 학습할 수 있어, 의료 데이터 활용 범위를 확대할 수 있다.
    - 연합학습과 지식 증류를 통해 병원별 데이터 특성을 상호 보완할 수 있어, 특정 질환에 편중된 학습 데이터의 한계를 극복하고 다양한 질환에 대한 일반화 성능을 확보할 수 있다.
    - 각 병원이 보유하지 않은 질환 유형에 대해서도 다른 병원의 학습 경험을 공유함으로써, 보고 사례가 적은 희귀 질환이나 드문 질환에 대한 진단 예측 정확도를 높일 수 있다.
3.  **효율적인 지식 공유**
    - 클러스터링 및 Representation-level KD를 통해, 모든 모달리티를 가진 클라이언트뿐만 아니라 결손된 클라이언트도 글로벌 모델 성능 향상에 기여할 수 있다.
4.  **일반화 성능 향상**
    - Cross-Attention 기반 글로벌 표현 학습을 통해, 다양한 모달리티 조합에서 강건하게 작동하는 모델을 구축할 수 있다.
    - 결손 데이터 환경에서도 일관된 성능을 보장함으로써 의료진이 AI를 보조적 도구로 신뢰할 수 있는 기반을 마련한다.
    - 더 나아가, 다양한 규모와 특성을 가진 병원들로 확장 적용이 가능해 의료 AI의 보급과 실질적 임상 적용을 촉진할 수 있다.

### b) 연구 의의
- **학문적 의의**: 기존의 중앙집중식 단일 모델 기반 missing modality 연구를 넘어, 연합학습 환경에서의 새로운 접근법을 제안함으로써 멀티모달 학습 연구 분야에 기여한다.
- **실무적 의의**: 의료 현장에서 발생하는 불완전한 데이터 환경을 직접적으로 반영한 연구로, 의료 AI 모델의 신뢰성 및 활용 가능성을 높인다.
- **사회적 의의**: 환자별로 결손된 정보를 보완하고 진단 정확도를 높임으로써, 의료 서비스 품질 향상과 더 나은 환자 치료 경험 제공에 기여할 수 있다.

## 2.5. 주요 기능 리스트
본 연구에서 제시하는 솔루션은 연합학습 환경에서의 missing modality 문제 해결을 목표로 하며, 다음과 같은 주요 기능을 포함한다.

1.  **클라이언트 클러스터링 기능**
    - 데이터 분포와 모달리티 보유 현황을 기반으로 클라이언트를 그룹화
    - 유사한 데이터 특성을 가진 클라이언트 집단 내에서 효율적인 협력 학습 가능
2.  **Representation-level Knowledge Distillation 기능**
    - 상대적으로 로컬 성능이 좋은 클라이언트(Teacher)로부터 낮은 성능의 클라이언트(Student)로 표현 지식 전달
    - 성능이 낮은 클라이언트들을 배제하지 않고 최대한 활용함으로 성능 저하를 최소화하고 FD 효과 극대화
3.  **Cross-Attention 기반 글로벌 표현 학습 기능**
    - 이미지와 텍스트 표현을 Cross-Attention 메커니즘으로 통합하여 missing-modality 문제 해결
    - 단일 모달리티만 가진 클라이언트도 글로벌 학습 과정에 기여할 수 있도록 지원
4.  **연합 학습 기반 모델 업데이트 기능**
    - 각 클라이언트에서 학습된 로컬 모델을 서버에서 통합하여 글로벌 모델 업데이트
    - 데이터 프라이버시를 보호하면서도 다양한 기관의 데이터 분포를 반영
5.  **모달리티 결손 상황 대응 기능**
    - 실제 임상 환경에서 발생하는 다양한 모달리티 결손 패턴에 대해 강건하게 동작
    - 단일 모달리티, 멀티모달리티, 부분 결손 등 다양한 경우를 지원

---

# 3. Project-Design (과제 설계)

## 3.1. 요구사항 정의

### a) 제안 솔루션 개요
본 연구는 연합학습(Federated Learning) 환경에서 발생하는 missing modality 문제를 해결하기 위해, 클라이언트 클러스터링, Representation-level Knowledge Distillation, Cross-Attention 기반 글로벌 표현 학습을 결합한 솔루션을 제안한다. 이를 통해 각 클라이언트가 보유한 모달리티 정보에 따라 발생하는 성능 격차를 줄이고, 결손 상황에서도 강건하게 작동하는 글로벌 모델을 구축한다.

### b) 기능별 요구사항 및 실험 설계

#### 1) 클라이언트 클러스터링
- **요구사항**: 각 클라이언트를 데이터 분포 및 모달리티 보유 현황에 따라 그룹화해야 한다.
- **실험 방법**:
    - 각 클라이언트의 로컬 표현 벡터를 추출 후 K-means 또는 계층적 클러스터링(Hierarchical clustering) 적용
    - 그룹 내에서 representation similarity가 높은지 측정
- **예상 결과**: 클러스터링을 적용한 그룹 내 클라이언트 간 협력이, 무작위 그룹 구성 대비 더 높은 정확도를 달성할 것으로 기대됨.

#### 2) Representation-level Knowledge Distillation
- **요구사항**: 모든 모달리티를 가진 클라이언트(Teacher)로부터 결손 모달리티 클라이언트(Student)로 지식을 전달해야 한다.
- **실험 방법**:
    - 훈련된 모델을 성능에 따라 두 그룹(Teacher, Student) 으로로 나눈 뒤 Teacher 모델의 중간 표현을 Student 모델에 distillation loss를 통해 전달
    - 결손 모달리티 환경에서 distillation 유무에 따른 성능 비교
- **예상 결과**: KD 적용 시 missing modality 환경에서도 정확도가 향상되며, Teacher와 Student 간 성능 격차가 줄어듦.

#### 3) Cross-Attention 기반 글로벌 표현 학습
- **요구사항**: 이미지와 텍스트 표현을 Cross-Attention을 통해 통합하고, 이를 글로벌 표현으로 활용해야 한다.
- **실험 방법**:
    - Cross-Attention 모듈 적용 전/후 글로벌 모델 성능 비교
    - 단일 모달리티 클라이언트가 글로벌 학습에 기여하는 정도 평가
- **예상 결과**: Cross-Attention 적용 시 다양한 모달리티 조합에서의 성능이 향상되고, 단일 모달리티 클라이언트도 글로벌 성능 개선에 기여.

#### 4) 연합학습 기반 글로벌 모델 업데이트
- **요구사항**: 클라이언트별 로컬 학습 결과를 집계하여 글로벌 모델을 정기적으로 업데이트해야 한다.
- **실험 방법**:
    - FedAvg, FedProx 등 기본 FL aggregation 기법과 제안 방법 비교
    - 기존 local model 의 성능 지표와 비교
    - aggregation 과정에서의 성능 안정성 측정
- **예상 결과**: 기존 aggregation 대비 missing modality 환경에서의 성능 유지력이 더 높음.

#### 5) 모달리티 결손 상황 대응
- **요구사항**: 단일 모달리티, 멀티모달리티, 부분 결손 상황 등 다양한 패턴에서도 강건하게 작동해야 한다.
- **실험 방법**:
    - 결손 비율(예: 10%, 30%, 50%)에 따른 성능 변화를 측정
    - 결손 모달리티 종류(image missing vs text missing)에 따른 성능 비교
- **예상 결과**: 제안 방법은 기존 방법 대비 결손 비율이 높아져도 성능 저하 폭이 낮고, 결손 패턴 변화에도 안정적으로 동작. 그러나 결손 모달리티가 특정 비율이 넘어가면 얻을 정보가 부족하여 성능 저하 예상.

## 3.2. 전체시스템 구성

<img width="805" height="335" alt="Image" src="https://github.com/user-attachments/assets/f6fe836a-79ec-4c45-ab43-463abb941e69" />

### a) 전체 개요
본 연구에서 제안하는 시스템은 연합학습(Federated Learning) 기반의 의료 데이터 분석 플랫폼으로, 클라이언트 단에서의 멀티모달 데이터 처리와 중앙 서버의 글로벌 모델 업데이트 과정을 통해 missing modality 문제를 해결한다.

### b) 주요 구성 요소

1.  **클라이언트(Client)**
    - 각 병원/기관에 해당하며, 이미지(X-ray)와 텍스트(진단 보고서) 데이터를 보유
    - 일부 클라이언트는 특정 모달리티가 결손된 상태로 존재 (image missing / text missing)
    - 로컬 모델을 학습하고, 표현 벡터 및 모델 파라미터를 서버로 전송
2.  **클러스터링 모듈(Clustering Module)**
    - 클라이언트들의 로컬 표현 벡터를 수집하여 데이터 분포/모달리티 보유 현황에 따라 그룹화
    - 유사한 특성을 가진 클라이언트 집단 내에서 효과적인 협력 학습 가능
3.  **Knowledge Distillation 모듈**
    - 모든 모달리티를 가진 클라이언트(Teacher)에서 결손 클라이언트(Student)로 표현 지식 전달
    - non-iid 환경에서도 성능 저하를 최소화
4.  **Cross-Attention 기반 표현 학습 모듈**
    - 이미지와 텍스트 표현을 통합하여 글로벌 표현(Global Representation)을 생성
    - 멀티 모달리티를 가진 클라이언트는 물론 단일 모달리티 클라이언트도 글로벌 학습에 기여할 수 있도록 지원
5.  **연합학습 서버(Federated Server)**
    - 각 클라이언트에서 전송된 모델 파라미터를 수집
    - FedAvg 등 aggregation 기법을 통해 글로벌 모델 업데이트 수행
    - 업데이트된 글로벌 모델을 다시 각 클라이언트로 배포

### c) 데이터 및 학습 흐름

1.  이미지-텍스트 모달리티가 동시에 존재하는 의료 데이터 - ROCO v2, MIMIC-CXR-jpg 사용(x-ray 사진-의사의 진단 pair)
2.  각 클라이언트는 로컬 데이터(이미지/텍스트)를 사용하여 모델 학습 수행
3.  로컬 모델 성능별로 그룹핑 후 그룹 내에서 Teacher-Student 기반 Representation-level KD 진행하여 로컬 단위의 성능 보완
4.  로컬 모델에서 추출한 표현 벡터는 클러스터링 모듈에 의해 그룹화
5.  Cross-Attention 모듈을 통해 이미지/텍스트 통합 글로벌 표현 학습
6.  로컬 모델 파라미터는 중앙 서버로 전송되고, 서버는 이를 집계하여 글로벌 모델 업데이트
7.  업데이트된 글로벌 모델은 다시 각 클라이언트로 배포되어 반복 학습 수행
