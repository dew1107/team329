# Federated Multimodal Learning Project

## ν”„λ΅μ νΈ μ†κ°

λ³Έ ν”„λ΅μ νΈλ” "μ„λ΅ λ‹¤λ¥Έ μΆ…λ¥μ λ°μ΄ν„°(λ¨λ‹¬λ¦¬ν‹°)" λ¥Ό λ³΄μ ν• μ—¬λ¬ ν΄λΌμ΄μ–ΈνΈκ°€ μμ‹ μ λ°μ΄ν„°λ¥Ό μ§μ ‘ κ³µμ ν•μ§€ μ•κ³ λ„ ν•¨κ» AI λ¨λΈμ„ ν•™μµν•  μ μλ„λ΅ μ„¤κ³„λ μ—°ν•© ν•™μµ(Federated Learning) μ‹μ¤ν…μ…λ‹λ‹¤.



> MRI μμƒλ§ μλ” λ³‘μ›, μ§„λ£ κΈ°λ΅λ§ μλ” λ³‘μ›, λ‘ λ‹¤ κ°€μ§„ λ³‘μ›μ΄ μλ‹¤κ³  κ°€μ •ν•΄ λ³΄κ² μµλ‹λ‹¤.
μ΄ λ³‘μ›λ“¤μ΄ μμ‹ μ λ°μ΄ν„°λ” μ™Έλ¶€μ— μ μ¶ν•μ§€ μ•μΌλ©΄μ„λ„, λ‘λ‘ν• AI μ§„λ‹¨ λ¨λΈμ„ ν•¨κ» ν•™μµν•  μ μλ” λ°©λ²•,
κ·Έκ²ƒμ΄ λ°”λ΅ λ³Έ ν”„λ΅μ νΈμ ν•µμ‹¬μ…λ‹λ‹¤.

## λ¬Έμ  μƒν™©
### 1. μ„λ΅ λ‹¤λ¥Έ μ •λ³΄λ§ λ³΄μ ν• ν΄λΌμ΄μ–ΈνΈ
μ–΄λ–¤ ν΄λΌμ΄μ–ΈνΈλ” μ΄λ―Έμ§€ λ°μ΄ν„°λ§ λ³΄μ ν•κ³  μμΌλ©°,

λ μ–΄λ–¤ ν΄λΌμ΄μ–ΈνΈλ” ν…μ¤νΈ λ°μ΄ν„°λ§ λ³΄μ ν•κ³  μμµλ‹λ‹¤.

λ‘ κ°€μ§€λ¥Ό λ¨λ‘ κ°€μ§„ ν΄λΌμ΄μ–ΈνΈλ” λ“λ­…λ‹λ‹¤.

### 2. λ°μ΄ν„°λ¥Ό κ³µμ ν•  μ μ—†λ” ν™κ²½
κ°μΈμ •λ³΄ λ³΄νΈμ™€ λ―Όκ° μ •λ³΄ μ μ¶ λ°©μ§€ λ“±μ μ΄μ λ΅ λ΅μ»¬ λ°μ΄ν„°λ¥Ό μ™Έλ¶€μ— κ³µμ ν•λ” κ²ƒμ΄ λ¶κ°€λ¥ν•©λ‹λ‹¤.

## ν•΄κ²° μ•„μ΄λ””μ–΄
κ° ν΄λΌμ΄μ–ΈνΈλ” μμ‹ μ΄ λ³΄μ ν• λ°μ΄ν„°λ§μ„ μ΄μ©ν•΄ λ¨λΈμ„ ν•™μµν•©λ‹λ‹¤.

μ„λ²„λ” λ¨λ“  ν΄λΌμ΄μ–ΈνΈμ λ¨λΈ κ°€μ¤‘μΉ(λλ” λ²΅ν„° μ •λ³΄)λ¥Ό λ¨μ•„ μµν•©ν•©λ‹λ‹¤.

λ¶€μ΅±ν• λ¨λ‹¬λ¦¬ν‹° μ •λ³΄λ” κΈ€λ΅λ² λ²΅ν„°λ¥Ό ν†µν•΄ λ³΄μ™„ν•©λ‹λ‹¤.

λ‹¨μΌ λ¨λ‹¬λ¦¬ν‹°λ§ κ°€μ§„ ν΄λΌμ΄μ–ΈνΈλ„, λ‹¤λ¥Έ ν΄λΌμ΄μ–ΈνΈμ λ„μ›€μ„ κ°„μ ‘μ μΌλ΅ λ°›μ•„ μ„±λ¥μ„ ν–¥μƒμ‹ν‚¬ μ μμµλ‹λ‹¤.

## μ „μ²΄ κµ¬μ΅°
```
CLIENT_ROOT/
β”‚
β”β”€β”€ client_0/
β”‚   β”β”€β”€ train/   β† μ΄λ―Έμ§€ λλ” ν…μ¤νΈ λ“±μ ν•™μµ λ°μ΄ν„°
β”‚   β”β”€β”€ val/     β† κ²€μ¦μ© λ°μ΄ν„°
β”‚   β”β”€β”€ best_model.pt β† ν•™μµλ λ΅μ»¬ λ¨λΈ
β”‚
β”β”€β”€ ...
β”β”€β”€ server/
β”‚   β””β”€β”€ global_vectors/ β† ν΄λΌμ΄μ–ΈνΈλ“¤μ΄ μ—…λ΅λ“ν• λ²΅ν„° μ •λ³΄
```

## λ¨λΈ κµ¬μ΅° (Fusion Classifier)
- μ΄λ―Έμ§€ μΈμ½”λ”: MobileNet V3

- ν…μ¤νΈ μΈμ½”λ”: BERT Tiny

- μµν•© λ°©μ‹: late fusion + gating mechanism
β†’ λ‘ λ²΅ν„°λ¥Ό λ‹¨μν ν•©μΉλ” κ²ƒμ΄ μ•„λ‹λΌ, κ°€μ¤‘μΉλ¥Ό μ΅°μ ν•μ—¬ μ¤‘μ”ν• μ •λ³΄μ— λ” μ§‘μ¤‘ν•λ„λ΅ μ„¤κ³„ν•μ€μµλ‹λ‹¤.

## ν•™μµ νλ¦„
### λ΅μ»¬ ν•™μµ

ν΄λΌμ΄μ–ΈνΈλ” μμ‹ μ λ°μ΄ν„°λ§μ„ ν™μ©ν•μ—¬ λ¨λΈμ„ ν•™μµν•©λ‹λ‹¤.

### κΈ€λ΅λ² λ²΅ν„° μ—…λ΅λ“

ν•™μµλ κ²°κ³Ό μ¤‘ ν•µμ‹¬ μ •λ³΄(λ²΅ν„°)λ¥Ό μ„λ²„μ— μ „μ†΅ν•©λ‹λ‹¤.

### μ„λ²„ μΈ΅ μµν•©

μ„λ²„λ” μ—¬λ¬ ν΄λΌμ΄μ–ΈνΈμ λ²΅ν„°λ¥Ό λ¨μ•„ μ „μ—­ μ •λ³΄λ¥Ό κµ¬μ„±ν•©λ‹λ‹¤.

### κΈ€λ΅λ² μ •λ³΄ λ°μ

ν΄λΌμ΄μ–ΈνΈλ” μ΄ μ „μ—­ μ •λ³΄λ¥Ό ν™μ©ν•μ—¬ λ¶€μ΅±ν• λ¨λ‹¬λ¦¬ν‹°λ¥Ό λ³΄μ™„ν•©λ‹λ‹¤.

### λ°λ³µ ν•™μµ

μ„ κ³Όμ •μ„ μ—¬λ¬ μ°¨λ΅€ λ°λ³µν•¨μΌλ΅μ¨ μ „μ²΄ λ¨λΈ μ„±λ¥μ„ μ μ°¨ ν–¥μƒμ‹ν‚µλ‹λ‹¤.

## μ½”λ“ μ²΄κ³„
### π“ 1. Local Area (λ΅μ»¬ ν•™μµ μμ—­)

κ° ν΄λΌμ΄μ–ΈνΈλ” λ‹¤μ μ¤‘ ν•λ‚μ λ¨λ‹¬λ¦¬ν‹° κµ¬μ„±μ— ν•΄λ‹Ήν•©λ‹λ‹¤:

- Image-only (2 clients)

- Text-only (2 clients)

- Image+Text (6 clients)

μ‚¬μ©λ λ¨λΈ:

- MobileNetV3: μ΄λ―Έμ§€ μΈμ½”λ”

- BERT Mini: ν…μ¤νΈ μΈμ½”λ”

μν–‰ λ΅μ§:

- κ³µν†µ λ°μ΄ν„°μ…‹(μ„λ²„μ—μ„ λ¶„λ°°λ¨)μ„ ν†µν•΄ κ° ν΄λΌμ΄μ–ΈνΈκ°€ λ΅μ»¬ ν•™μµ μν–‰

- image_encoder() / text_encoder()λ¥Ό ν†µν•΄ ν‘ν„ λ²΅ν„° μ¶”μ¶

- ν΄λΌμ΄μ–ΈνΈλ³„λ΅ local encoder output μ €μ¥ (e.g., img_vec.pt, txt_vec.pt)

### π“ 2. Global Area (ν΄λ¬μ¤ν„°λ§ λ° μµν•© μμ—­)
ν‘ν„ λ²΅ν„° μμ§‘ λ° ν΄λ¬μ¤ν„°λ§:

- κ° ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° μμ§‘λ μ΄λ―Έμ§€/ν…μ¤νΈ λ²΅ν„°μ— λ€ν•΄ K-Means μ μ©

- Hungarian AlgorithmμΌλ΅ cross-modality pair μµμ ν™”

**Late Fusion:**

- κ° modality ν΄λ¬μ¤ν„°μ—μ„ μ¤‘μ‹¬ λ²΅ν„°(center vector)λ¥Ό μ¶”μ¶ν•μ—¬ Late Fusion

**Cross-Attention & Gating:**

- CrossAttentionTransformer: μ΄λ―Έμ§€-ν…μ¤νΈ μ¤‘μ‹¬ λ²΅ν„° κ°„ ν•µμ‹¬ μ •λ³΄ Z μ¶”μ¶

- GatingMechanism: forget gate κΈ°λ°μΌλ΅ μµμΆ… ν†µν•© ν‘ν„ R μƒμ„±

### π“ 3. Classification & Global Update (λ¶„λ¥ λ° κΈ€λ΅λ² μ—…λ°μ΄νΈ μμ—­)
λ¶„λ¥:

- ν†µν•© ν‘ν„ Rμ„ μ…λ ¥μΌλ΅ ν•λ” FusionClassifier μν–‰

- Cross-entropy lossλ΅ μµμΆ… classification κ²°κ³Ό λ„μ¶

**κΈ€λ΅λ² μ—…λ°μ΄νΈ:**

- ν΄λΌμ΄μ–ΈνΈλ³„ adapter layer(Fusion Classifier μ•λ‹¨) μ„±λ¥ κΈ°λ° κΈ°μ—¬λ„λ¥Ό κ³„μ‚°

- κ³„μ‚°λ κΈ°μ—¬λ„λ¥Ό λ°”νƒ•μΌλ΅ κ°€μ¤‘ ν‰κ·  λ°©μ‹μΌλ΅ κΈ€λ΅λ² λ¨λΈ μ—…λ°μ΄νΈ

- adapter weight(λ΅μ»¬μ—μ„ μƒλ΅ κ³„μ‚°λ weight)λ” μ„λ²„μ—μ„ ν†µν•© ν›„ μ¬λ°°ν¬ν•, local encoderλ” ν΄λΌμ΄μ–ΈνΈκ°€ μ μ§€

`classification_01.jpynb` νμΌ μ„¤λ…
| νμΌ / ν•¨μλ…                      | μ„¤λ…                                              |
| ----------------------------- | ----------------------------------------------- |
| `run_client_training()`       | κ° ν΄λΌμ΄μ–ΈνΈμ—μ„ λ΅μ»¬ ν•™μµ μν–‰                              |
| `extract_representations()`   | MobileNetV3 / BERT Miniλ΅ μ΄λ―Έμ§€/ν…μ¤νΈ λ²΅ν„° μ¶”μ¶          |
| `run_clustering_and_fusion()` | K-Means, Hungarian μ•κ³ λ¦¬μ¦ λ° Cross-Attention μµν•© μ²λ¦¬ |
| `FusionClassifier`            | μµμΆ… ν†µν•© ν‘ν„ Rμ— λ€ν• λ¶„λ¥κΈ°                              |
| `global_update()`             | ν΄λΌμ΄μ–ΈνΈλ³„ κ°€μ¤‘μΉ λ°μ ν›„ κΈ€λ΅λ² λ¨λΈ μ—…λ°μ΄νΈ                     |


## κΈ°λ€ ν¨κ³Ό
- λ¨λ‹¬λ¦¬ν‹° κ²°μ† λ¬Έμ  ν•΄κ²°: λ¶€μ΅±ν• μ •λ³΄λ¥Ό κΈ€λ΅λ² λ²΅ν„°λ¥Ό ν†µν•΄ λ³΄μ™„ν•  μ μμµλ‹λ‹¤.

- κ°μΈμ •λ³΄ λ³΄νΈ λ³΄μ¥: μ›λ³Έ λ°μ΄ν„°λ” μ λ€ μ™Έλ¶€λ΅ μ μ¶λμ§€ μ•μµλ‹λ‹¤.

- λ¨λΈ μ„±λ¥ ν–¥μƒ: ν΄λΌμ΄μ–ΈνΈλ“¤μ΄ μ„λ΅ κ°„μ ‘μ μΌλ΅ λ„μ›€μ„ μ£Όκ³ λ°›μΌλ©° μ„±λ¥μ΄ ν–¥μƒλ©λ‹λ‹¤.

## μ‹¤ν–‰ λ°©λ²•

# μμ‹ μ‹¤ν–‰ μ½”λ“ (Python κ°€μƒν™κ²½ ν™μ„±ν™” ν›„)
```
python train_clients.py  # λ¨λ“  ν΄λΌμ΄μ–ΈνΈ κ°λ³„ ν•™μµ
python aggregate_vectors.py  # μ„λ²„μ—μ„ λ²΅ν„° μµν•©
python update_clients.py  # ν΄λΌμ΄μ–ΈνΈκ°€ κΈ€λ΅λ² μ •λ³΄ λ°μ
β€» μ‹¤μ  μ‹¤ν–‰ μ‹, ν΄λΌμ΄μ–ΈνΈλ³„ λ””λ ‰ν† λ¦¬ κµ¬μ„±κ³Ό ν™κ²½ μ„¤μ •μ΄ ν•„μ”ν•©λ‹λ‹¤.
```

## μ‚¬μ© κΈ°μ 
- Python, PyTorch

- HuggingFace Transformers

- torchvision (MobileNetV3)

- μ—°ν•© ν•™μµ κµ¬μ΅° (custom FL pipeline)

- Gating Mechanism κΈ°λ° Late Fusion
